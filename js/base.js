var ddb,B;switch(function(){var a,b,d,e,f,g;$.os||(a={},b=navigator.userAgent,navigator.platform,d=b.match(/(Android);?[\s\/]+([\d.]+)?/),e=b.match(/(iPad).*OS\s([\d_]+)/),f=b.match(/(iPod)(.*OS\s([\d_]+))?/),g=!e&&b.match(/(iPhone\sOS)\s([\d_]+)/),d&&(a.android=!0,a.version=d[2]),g&&!f&&(a.ios=a.iphone=!0,a.version=g[2].replace(/_/g,".")),e&&(a.ios=a.ipad=!0,a.version=e[2].replace(/_/g,".")),f&&(a.ios=a.ipod=!0,a.version=f[3]?f[3].replace(/_/g,"."):null),$.os=a)}(),Number.prototype.add=function(a){var b,c,d;try{c=this.toString().split(".")[1].length}catch(e){c=0}try{d=a.toString().split(".")[1].length}catch(e){d=0}return b=Math.pow(10,Math.max(c,d)),(this.mul(b)+a.mul(b))/b},Number.prototype.sub=function(a){return this.add(-a)},Number.prototype.mul=function(a){var b=0,c=this.toString(),d=a.toString();try{b+=c.split(".")[1].length}catch(e){}try{b+=d.split(".")[1].length}catch(e){}return Number(c.replace(".",""))*Number(d.replace(".",""))/Math.pow(10,b)},Number.prototype.div=function(a){var d,e,b=0,c=0;try{b=this.toString().split(".")[1].length}catch(f){}try{c=a.toString().split(".")[1].length}catch(f){}return d=Number(this.toString().replace(".","")),e=Number(a.toString().replace(".","")),(d/e).mul(Math.pow(10,c-b))},Date.prototype.format=function(a){var c,b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a},ddb={},ddb.version="3.0.1",ddb.isWeixin=/MicroMessenger/i.test(navigator.userAgent),ddb.isApp=/DaDaBusPassenger/i.test(navigator.userAgent),ddb.isAndroidApp=ddb.isApp&&$.os.android,ddb.isIosApp=ddb.isApp&&$.os.ios,B={},B.url={},B.url.getParam=function(a,b){var c,d;return b=b||location.href,c=new RegExp("(^|&|\\?|#)"+a+"=([^&]*?)(&|#|$)"),d=b.match(/#.*/)?b.match(/#.*/)[0]:"",b=b.replace(/#.*/,""),c.test(d)?decodeURIComponent(d.match(c)[2]):c.test(b)?decodeURIComponent(b.match(c)[2]):""},B.url.setParam=function(a,b,c,d){if("undefined"==typeof a||"undefined"==typeof b||"undefined"==typeof c)return c;var e,f=new RegExp("(^|&|\\?|#)"+a+"=([^&]*?)(&|#|$)"),g=c.match(/#.*/)?c.match(/#.*/)[0]:"";return c=c.replace(/#.*/,""),d===!0?(f.test(g)?g=g.replace(f,function(c,d,e,f){return d+a+"="+encodeURIComponent(b)+f}):(e=-1===g.indexOf("#")?"#":"&",g=g+e+a+"="+encodeURIComponent(b)),g=g.replace(f,function(c,d,e,f){return d+a+"="+encodeURIComponent(b)+f}),g+c):(f.test(c)?c=c.replace(f,function(c,d,e,f){return d+a+"="+encodeURIComponent(b)+f}):(e=-1===c.indexOf("?")?"?":"&",c=c+e+a+"="+encodeURIComponent(b)),c+g)},B.url.delParam=function(a,b){var c=new RegExp("[?&]"+a+"=[^&#]*&?","g");return b?b.replace(c,""):(history.replaceState(null,"",location.href.replace(c,"")),void 0)},B.url.setHash=function(a,b){return b=b||location.href,b.replace(/(?:#(.*))?$/,a)},B.url.parseHash=function(a){var c,f,g,h,d={},e=a.split("?"),b=e[0];if(e.length>1)for(c=e[1],f=c.split("&"),h=0;h<f.length;h++)f[h]&&(g=f[h].split("="),d[g[0]]=g[1]);return{hash:a,tag:b,query:c,param:d}},B.url.serializeArray=function(a){var c,d,e,b={};try{for(a=a.split("&"),d=0,e=a.length;e>d;d++)a[d]&&(c=a[d].split("="),b[c[0]]=c[1])}catch(f){alert("解析公用参数出错："+f)}return b},B.url.getObj=function(a){var b=B.url.parseHash(a);return b.param},B.url.setObj=function(a,b){return $.each(b,function(b,c){a=B.url.setParam(b,c,a)}),a},ddb.wxid=B.url.getParam("wxid")||window.sessionStorage.getItem("ddb_wxid")||1,ddb.dev_status="release",ddb.appid=2==ddb.wxid?"wxfeb03a6635e532d7":"wx72a2b17c7ed41fe8",location.hostname.split(".")[0]){case"loc":case"dev":ddb.dev_status="dev",ddb.appid="wx54125ac4cf97185c";break;case"test":ddb.dev_status="test",ddb.appid="wx72a2b17c7ed41fe8";break;case"pre":ddb.dev_status="pre"}ddb.sld="release"===ddb.dev_status?"":ddb.dev_status+".",ddb.host=location.host.replace("static.",""),ddb.api="http://"+ddb.sld+"api.buskeji.com/",ddb.wxapi="http://"+ddb.host+"/app/api?parames=",ddb.appkey="release"===ddb.dev_status?"uwd1c0sxd3621":"pvxdm17jx8rqr",ddb.wxsdk="http://res.wx.qq.com/open/js/jweixin-1.0.0.js",ddb.xhrs=[],ddb.noop=function(){},ddb.fitEnv=function(a){return"release"===ddb.dev_status?a:a.replace(/\/\/(dev|test)\./,"//"+location.hostname.split(".")[0]+".")},ddb.loadJs=function(a,b){var c=document.createElement("script");"function"==typeof b&&(c.onload=b),c.src=a,document.head.appendChild(c)},B.user={},B.user.isLogin=function(){return!!(ddb.cookie("wx_user_id")&&ddb.cookie("wx_mobile")&&ddb.cookie("wx_ddb_token")&&ddb.cookie("wx_device_id"))},B.user.login=function(a,b){a=encodeURIComponent(a||location.href);var c="http://"+ddb.host+"/webapp/login.html?referrer="+a;b?location.replace(c):location.href=c},B.user.clearLogin=function(a){(!ddb.isIosApp||a)&&(ddb.cookie("wx_user_id","",{path:"/"}),ddb.cookie("wx_mobile","",{path:"/"}),ddb.cookie("wx_device_id","",{path:"/"}),ddb.cookie("wx_ddb_token","",{path:"/"}),ddb.cookie("wx_is_bind","",{path:"/"}),ddb.removeStoragesBut("ddb_src_id|ddb_wxid|ddb_user_gps|wx_openid_wxid1|wx_openid_wxid2","sessionStorage"),ddb.session("appCommon",null),"function"==typeof a?a():ddb.isApp||location.reload())},B.user.logout=function(a,b){var c,d;b=b||B.user.login,a?(c=(ddb.isWeixin?ddb.wxapi:ddb.api)+"authentication/logout",d=ddb.isWeixin?{urlType:"app"}:{},ddb.get(c,d).done(function(a){0===+a.ret?B.user.clearLogin(b):ddb.msg(a.msg)}).fail(function(){alert("服务器错误")})):B.user.clearLogin(b)},function(){function a(){var a=ddb.cookie("wx_mobile"),b=ddb.pgps("ddb_user_gps"),c=(ddb.store("ddbCity")||"").split("/")[1],d=ddb.session("ddb_src_id");a&&a!==ddb.common.mobile&&(ddb.common.mobile=a,ddb.common.user_id=ddb.cookie("wx_user_id"),ddb.common.device_id=ddb.cookie("wx_device_id"),ddb.common.ddb_token=ddb.cookie("wx_ddb_token")),b&&(ddb.common.lng=b.lng,ddb.common.lat=b.lat,ddb.common.gps_sampling_time=b.gps_sampling_time),c&&(ddb.common.city_code=c),d&&(ddb.common.ddb_src_id=d)}function b(b){function f(a){return 8001===+a.ret||8002===+a.ret||8003===+a.ret?b.notCheckLogin?(B.user.clearLogin(),d.reject(a),void 0):B.user.isLogin()?(B.user.logout(),void 0):(B.user.login(),void 0):6001===+a.ret?(ddb.isWeixin&&!b.notCheckLogin&&ddb.getOpenId(0,!0),d.reject(a),void 0):(d.resolve(a),void 0)}var c,d,e;return a(),b.data=$.extend({},ddb.common,b.data||{}),/^https?:/i.test(b.url)||(b.url="app"===b.urlType?b.url:ddb.api+b.url),c=b.cachekey?ddb.session(b.cachekey):null,d=$.Deferred(),c?(f(c),d.promise()):(b.noLoading||ddb.loading.show(),e=$.ajax({type:b.type||"GET",url:b.url,data:b.data,dataType:b.dataType||"json",cache:b.cache||!1,timeout:b.timeout||8e3,success:function(a){b.noLoading||ddb.loading.hide(),f(a),console.log("AJAX: "+b.url+"\n ",a),b.cachekey&&0===+a.ret&&ddb.session(b.cachekey,a)},error:function(a,c){b.noLoading||ddb.loading.hide(),console.log("网络异常["+c+"]"),d.reject(a)}}),ddb.xhrs.push(e),b.returnXhr?e:d.promise())}function c(b,c,d,e){function j(a){return 8001===+a.ret||8002===+a.ret||8003===+a.ret?c.notCheckLogin?(B.user.clearLogin(),f.reject(a),void 0):B.user.isLogin()?(B.user.logout(),"function"==typeof d&&d(a),void 0):(B.user.login(),void 0):6001===+a.ret?(ddb.isWeixin&&!c.notCheckLogin&&ddb.getOpenId(0,!0),f.reject(a),void 0):("function"==typeof d&&d(a),f.resolve(a),void 0)}var f,g,h,i;return"function"==typeof c&&(e=d,d=c,c={}),a(),c=$.extend({},ddb.common,c||{}),f=$.Deferred(),g=c.cachekey,h=g?ddb.session(g):null,/^https?:/i.test(b)||(b="app"===c.urlType?b:ddb.api+b),h?(j(h),f.promise()):(c.noLoading||ddb.loading.show(),i=$.ajax({url:b,type:"GET",data:c,dataType:c.dataType||"json",cache:c.cache||!1,timeout:c.timeout||8e3,success:function(a){ddb.loading.hide(),console.log("GET: "+b+"\n ",a),j(a),g&&0===+a.ret&&ddb.session(g,a)},error:function(a,b){ddb.loading.hide(),"function"==typeof e&&e(a,b),console.log("网络异常["+b+"]"),f.reject(a)}}),ddb.xhrs.push(i),c.returnXhr?i:f.promise())}function d(b,c,d,e){function j(a){return 8001===+a.ret||8002===+a.ret||8003===+a.ret?B.user.isLogin()?(B.user.logout(),void 0):(B.user.login(),void 0):("function"==typeof d&&d(a),f.resolve(a),void 0)}var f,g,h,i;return a(),c=$.extend({},ddb.common,c||{}),/^https?:/i.test(b)||(b="app"===c.urlType?b:ddb.api+b),f=$.Deferred(),g=c.cachekey,(h=g?ddb.session(g):null)?(j(h),f.promise()):(c.noLoading||ddb.loading.show(),i=$.ajax({url:b,type:"POST",data:c,dataType:c.dataType||"json",cache:c.cache||!1,timeout:c.timeout||8e3,success:function(a){ddb.loading.hide(),console.log("POST: "+b+"\n ",a),j(a),g&&0===+a.ret&&ddb.session(g,a)},error:function(a,b){ddb.loading.hide(),"function"==typeof e&&e(a,b),console.log("网络异常["+b+"]"),f.reject()}}),ddb.xhrs.push(i),f.promise())}function e(b,c,d,e){function h(a){return 8001===+a.ret||8002===+a.ret||8003===+a.ret?B.user.isLogin()?(B.user.logout(),void 0):(B.user.login(),void 0):(d(a),void 0)}var g,f=new FormData;b=ddb.api+b,a(),c=$.extend({},ddb.common,c);for(g in c)c.hasOwnProperty(g)&&"hasOwnProperty"!==g&&(c[g].name?f.append(g,c[g],c[g].name):f.append(g,c[g]));ddb.loading.show(),$.ajax({url:b,dataType:"json",type:"POST",data:f,timeout:c.timeout||2e4,cache:!1,processData:!1,contentType:!1,success:function(a){ddb.loading.hide(),h(a),console.log("UPLOAD: "+b+"\n ",a)},error:function(a,b){ddb.loading.hide(),"function"==typeof e&&e(a,b),console.log("上传出错["+b+"]")}})}function f(b,c,d,e){function j(a){"function"==typeof d&&d(a),f.resolve(a)}var f,g,h,i;return"function"==typeof c&&(e=d,d=c,c={}),a(),c=$.extend({},ddb.common,c||{}),f=$.Deferred(),g=c.cachekey,h=g?ddb.session(g):null,/^https?:/i.test(b)||(b="app"===c.urlType?b:ddb.api+b),h?(j(h),f.promise()):(c.noLoading||ddb.loading.show(),i=$.ajax({url:b,type:"GET",data:c,dataType:"jsonp",cache:c.cache||!1,jsonp:"cb",timeout:c.timeout||8e3,success:function(a){ddb.loading.hide(),console.log(a),j(a),g&&0===+a.ret&&ddb.session(g,a),console.log("JSONP: "+b+"\n ",a)},error:function(a,b){ddb.loading.hide(),"function"==typeof e&&e(a,b),console.log("网络异常：",a),f.reject(a)}}),ddb.xhrs.push(i),f.promise())}function g(a,b){var c,d;B.url.getParam("hasOpenid")||(a=a||location.href,b=b||ddb.isWeixin,c=B.url.setParam("referrerSrc",a,"http://"+ddb.host+"/wechat_menu/getOpenId"),d=c,b&&(d=B.url.setObj("https://open.weixin.qq.com/connect/oauth2/authorize",{appid:ddb.appid,redirect_uri:c,response_type:"code",scope:"snsapi_base"})+"#wechat_redirect"),location.replace(d))}function h(a,b,c){function d(a,b,c){var d=c.expires,e=c.path,f=c.domain,g=c.secure;return"number"==typeof d&&(d=new Date((new Date).getTime()+864e5*d)),document.cookie=a+"="+escape(b)+(d?"; expires="+d.toUTCString():"")+(e?"; path="+e:"")+(f?"; domain="+f:"")+(g?"; secure":""),!0}function e(a){var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!==b?unescape(b[2]):""}function f(a,b){return b.expires=new Date(0),d(a,"",b)}return c=c||{},"undefined"==typeof b?e(a):null===b||""===b?f(a,c):d(a,b,c)}function i(a,b,c){b=b||"http://"+ddb.host+"/webapp/"+a,c&&window.history.replaceState(history.state,"",b),location=b}function j(a,b,c){try{window[a].setItem("test-storage","test"),window[a].removeItem("test-storage")}catch(d){return alert("您开启了无痕模式或禁用了缓存，为了能享受更好的服务，请更改您的设置。"),void 0}if("undefined"==typeof c)try{return JSON.parse(window[a].getItem(b))}catch(e){return window[a].getItem(b)}else{if(null===c||""===c)return window[a].removeItem(b);try{return window[a].setItem(b,JSON.stringify(c))}catch(f){return"sessionStorage"===a?ddb.removeStoragesByKeyContains("/",a):ddb.removeStoragesBut("ddbCity|isAward|ddbSearch|travel_city_code|waitBusTips",a),window[a].setItem(b,JSON.stringify(c))}}}function k(a,b){return j("localStorage",a,b)}function l(a,b){return j("sessionStorage",a,b)}function m(a,b){var e,c=window[b||"sessionStorage"],d=c.length;if(!c)return alert("为了能享受更好的服务，请关闭浏览器的无痕模式！"),void 0;for(;d;)d--,e=c.key(d),-1!==e.indexOf(a)&&c.removeItem(e)}function n(a,b){var c,d,e;if(a=a.split("|"),c=window[b||"localStorage"],d=c.length,!c)return alert("为了能享受更好的服务，请关闭浏览器的无痕模式！"),void 0;for(;d;)d--,e=c.key(d),-1===a.indexOf(e)&&c.removeItem(e)}function o(a){("release"!==ddb.dev_status||ddb.debugMobile===ddb.cookie("wx_mobile"))&&console.log("Debug: ",a)}function p(a,b,c,d){function g(){var a,d;b.order_type?1===b.order_type&&ddb.post("goods_order/pay_confirm",{order_number:e},function(a){if(0!==+a.ret)return alert(a.msg),void 0;switch(+a.data.order_info.status){case 2:return ddb.removeStoragesByKeyContains("member/get_ticket_count?date="),ddb.pgps("home/get_line_recommend",null),c(e),void 0;case 1:alert("订单未支付");break;case 3:alert("订单已关闭")}h()}):(a="order/pay_confirm",d={order_number:e,dada_flag:1},b.isCharteredBus&&(a="chartered/pay_confirm",d={order_id:e,payment_id:b.pay_order_info.payment_id}),ddb.get(a,d,function(a){function d(a){ddb.store("isAward")||(ddb.pgps("award",$.extend(ddb.pgps("award")||{},{show_award:a.show_award,award_title:a.award_title,award_msg:a.award_msg})),ddb.store("isAward",1)),ddb.pgps("activeInfo",{show_active:a.show_active,active_title:a.active_title,share_type:a.share_type}),b.isCharteredBus||(ddb.removeStoragesByKeyContains("member/get_ticket_count?date="),ddb.pgps("home/get_line_recommend",null)),c(e),b.isCharteredBus||(b.isCharteredBus||(f=ddb.fitEnv(a.success_url)||f),location.href=f)}if(0!==+a.ret)return alert(a.msg),void 0;switch(a.data.status){case"success":return d(a.data),void 0;case"error invalid_order_number":alert("订单号错误");break;case"order_unpaid":alert("订单未支付");break;case"order_has_been_canceled":alert("订单已取消");break;case"failed":}f=B.url.setParam("pay_status","fail",f),h()}))}function h(){d(e),b.isCharteredBus||1!==b.order_type&&(location.href=f)}var e=b.order_number,f=B.url.setParam("order_number",e,"order_details.html");switch(b.isCharteredBus&&(f=B.url.setObj("chartered_order_details.html",{order_id:e,use_native_page:!1})),f=B.url.setObj(f,{pay_status:a,line_type:b.line_type}),1===b.order_type&&(f=B.url.setObj("product_order_details.html",{order_type:b.order_type,order_number:e})),c=c||ddb.noop,d=d||c,a){case"ok":return ddb.loading.show(),setTimeout(g,1500),void 0;case"cancel":case"fail":return h(),void 0}}function q(a,b,c){function e(d){var e=ddb.common.version<"2.7.0";1===d?(a.payChannel="wxpay",a.payInfo=e?a.pay_order_info.wx_prepay_id:JSON.stringify(a.pay_order_info.wx_params)):2===d&&(a.payChannel="alipay",a.payInfo=a.pay_order_info.alipay_params),e?ddb.appCall("pay",a.payChannel,a.payInfo):ddb.appCall("payment",a.payChannel,a.payInfo,function(d){ddb.Popup.close(),d?p("ok",a,b,c):p("fail",a,b,c)}),ddb.Popup.confirm({title:"支付提醒",content:"是否已经完成支付",cancelText:"遇到问题",okText:"完成支付",okCall:function(){p("ok",a,b,c)},cancelCall:function(){p("ok",a,b,c)}})}function f(){if(ddb.isWeixin){if("release"!==ddb.dev_status)return alert("测试公众号不支持微信支付"),void 0;if(a.pay_order_info&&a.pay_order_info.wx_params){var d=a.pay_order_info.wx_params;return d={appId:d.appid,timeStamp:d.time_stamp.toString(),nonceStr:d.nonce_str,"package":"prepay_id="+d.prepay_id,signType:d.sign_type,paySign:d.sign},WeixinJSBridge.invoke("getBrandWCPayRequest",d,function(d){"get_brand_wcpay_request:ok"===d.err_msg?p("ok",a,b,c):"get_brand_wcpay_request:cancel"===d.err_msg?p("cancel",a,b,c):p("fail",a,b,c)}),void 0}a.urlType="app",a.wxid=1,ddb.get("/app/weixinOerderPay/",a,function(d){0===+d.ret?WeixinJSBridge.invoke("getBrandWCPayRequest",d.msg,function(d){"get_brand_wcpay_request:ok"===d.err_msg?p("ok",a,b,c):"get_brand_wcpay_request:cancel"===d.err_msg?p("cancel",a,b,c):p("fail",a,b,c)}):alert("获取微信支付包失败："+d.msg)})}else ddb.isApp&&(a.payChannel="wxpay",a.payInfo=a.pay_order_info.wx_prepay_id,e(1))}function g(){var e="http://"+ddb.host+"/webapp/",f={order_number:d,return_url:e+"pay_success.html?pay_type=aliwebpay&order_number="+d};return a.isCharteredBus?(a.pay_order_info&&a.pay_order_info.html_text?$(a.pay_order_info.html_text).hide().appendTo("body"):c(d),void 0):1===a.order_type?(a.pay_order_info&&a.pay_order_info.alipay_html?$(a.pay_order_info.alipay_html).hide().appendTo("body"):c(d),void 0):(ddb.get("order/h5_alipay",f,function(a){return 0!==+a.ret?(alert(a.msg),void 0):(b(d),$(a.data.alipay_html).hide().appendTo("body"),void 0)}),void 0)}if(!a.order_number)return alert("订单号无效 T_T"),void 0;var d=a.order_number;switch(b=b||ddb.noop,c=c||b,+a.pay_type){case 1:setTimeout(f,1500);break;case 2:e(2);break;case 4:g();break;case 8:ddb.cookie("fqlpay_order_number",d,{expires:1}),location=a.pay_order_info.fenqile_url}}function r(a){return ddb.Toast.show(a)}function s(a,b){var c=$("."+a);$.each(c,function(a,c){var d,e,f,g,h,i,j;$(c).removeClass("m-marquee"),d=$(c).html(),e=$(c).data("html"),b||(b="default"),e&&-1===b.indexOf("change")&&(d=e),$(c).html("<span>"+d+"</span>"),f=$(c).width()-parseFloat($(c).css("padding-left")),g=$(c).find("span").width(),g>f?($(c).data("html",d),$(c).html("<p><label><span>"+d+"</span><span>"+d+"</span></label></p>"),$(c).addClass("m-marquee"),h=parseFloat($(c).find("span").css("padding-right")),i=$(c).find("label"),i.width(2*(g+h)),-1!==b.indexOf("auto")&&(j=3*Math.floor(g/f)+7,j>20&&(j=20),i[0].style.cssText+="-webkit-animation: marquee "+j+"s linear 1.5s infinite;",i[0].style.cssText+="animation: marquee "+j+"s linear 1.5s infinite;")):$(c).html(d)})}function t(a){if(document.title=a,$.os.ios)var b=$('<iframe src="about:blank" style="display:none;"></iframe>').on("load",function(){setTimeout(function(){b.off("load").remove()},0)}).appendTo("body")}ddb.jump=i,ddb.initCommon=a,ddb.ajax=b,ddb.get=c,ddb.post=d,ddb.upload=e,ddb.getJsonp=f,ddb.store=k,ddb.pgps=l,ddb.session=l,ddb.removeStoragesByKeyContains=m,ddb.removeStoragesBut=n,ddb.cookie=h,ddb.payOrder=q,ddb.debug=o,ddb.msg=r,ddb.payCallback=p,ddb.getOpenId=g,ddb.marqueeLine=s,ddb.setTitle=t,$.os.ios&&/MQQBrowser/i.test(navigator.userAgent)&&(ddb.session=ddb.pgps=ddb.store),ddb.getWxUserInfo=function(a,b,c){a=(a||location.href).replace(/\/\/\w+\.wechat/,"//wechat"),b="userinfo"===b?"snsapi_userinfo":"snsapi_base",c=c||ddb.appid;var d=["https://open.weixin.qq.com/connect/oauth2/authorize?","appid="+c,"&redirect_uri="+encodeURIComponent(a),"&response_type=code","&scope="+b,"#wechat_redirect"].join("");location=d},ddb.abortXHRs=function(){ddb.xhrs.forEach(function(a){a.abort(),console.log("Abort XHR: ",a)}),ddb.xhrs=[]},ddb.showShareit=function(){if(!ddb.isWeixin)return alert("请在嗒嗒微信众号中分享"),void 0;var a=document.getElementById("shareit");a?a.style.display="block":$('<div id="shareit"><p>点击右上角分享</p></div>').appendTo("body").on("click",function(){this.style.display="none"})},ddb.getPageLink=function(a){var b={item_type:a.item_type||1,line_code:a.line_code,noLoading:!0};a.startDate&&(b.start_date=a.start_date),ddb.get("line/get_line_config",b,function(b){function d(a){var b=a.title.replace(/<[^>]+>/g,"");return b.length<8}if(0===+b.ret){var c={};c.type={},c.list=b.data.item_list.slice(0,3).map(function(a,b,c){a.title;var e=18;switch(c.length){case 1:break;case 2:e=16;break;case 3:e=8}return a}),2===c.list.length&&c.list.every(d)&&(c.type.less8=!0),a.callback(c)}else alert(b.msg)})},ddb.device=function(){var a=window.devicePixelRatio||1;return screen.width===document.documentElement.clientWidth?{width:screen.width*a,height:screen.height*a,dpr:a}:{width:screen.width,height:screen.height,dpr:a}}(),ddb.common={version:ddb.version,wxid:ddb.wxid,user_id:"0",login_type:1,device_type:3,screen:ddb.device.width+":"+ddb.device.height+"|"+ddb.device.dpr,source:ddb.isWeixin?3:5};var u=B.url.getParam("ddb_src_id");u&&ddb.session("ddb_src_id",u),ddb.wxid&&window.sessionStorage.setItem("ddb_wxid",ddb.wxid),a()}(),ddb.inPath=function(a){return new RegExp("/("+a+")/","i").test(location.pathname)},ddb.fileName=location.pathname.slice(location.pathname.lastIndexOf("/")+1),ddb.wx={},ddb.wx.getUserinfo=function(a,b){ddb.isWeixin&&("function"==typeof a&&(b=a),a=$.extend({urlType:"app",cachekey:"app/get_wx_userinfo?wxid="+(a.wxid||ddb.wxid),notCheckLogin:!0},a||{}),ddb.get("/app/get_wx_userinfo",a,function(c){c.data&&(ddb.wxUserinfo=c.data,ddb.unionid=ddb.wxUserinfo.unionid,ddb.wxUserinfo.openid&&ddb.session("wx_openid_wxid"+a.wxid,ddb.wxUserinfo.openid),"function"==typeof b&&b(ddb.wxUserinfo))}))},ddb.wx.getInfo=function(a,b){ddb.isWeixin&&("function"==typeof a&&(b=a,a=location.href.split("#")[0]),ddb.get(ddb.wxapi+"wechat_api/jssdk",{urlType:"app",wxUrl:a,noLoading:!0},function(a){0===+a.ret&&(ddb.JSSDK_CFG=a.JSSDK_CFG,ddb.openid=a.JSSDK_CFG.open_id,ddb.openid&&ddb.session("wx_openid_wxid"+ddb.wxid,ddb.openid),"function"==typeof b&&b(a.JSSDK_CFG))}))},ddb.wx.shareConfig={title:"欢乐斗地主嗒嗒巴士赛",desc:"斗地主，赢福利，一大波福利来袭",link:"http://"+ddb.host+"/h5/active/dadaddz/index.html",imgUrl:"http://"+ddb.host+"/h5/active/dadaddz/image/share.png",timeline:{imgUrl:"http://"+ddb.host+"/h5/active/dadaddz/image/share.png"},appMessage:{},QQ:{},QZone:{}},ddb.wx.setConfig=function(a,b){ddb.wx.hasConfig||(wx.config($.extend({debug:b||!1,appId:a.msg.appId,timestamp:a.msg.timestamp,nonceStr:a.msg.nonceStr,signature:a.msg.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","chooseImage","previewImage","openLocation","getLocation","hideMenuItems","showMenuItems","closeWindow","getNetworkType"]},a.config||{})),ddb.wx.hasConfig=!0)},ddb.wx.share=function(a,b){function d(c){ddb.wx.shared=!0,ddb.wx.setConfig(c,b),wx.ready(function(){var e,b=$.extend({},ddb.wx.shareConfig,a.JSSDK_Share),d={title:b.title,desc:b.desc,link:b.link,imgUrl:b.imgUrl};d.success=function(b){document.getElementById("shareit")&&$("#shareit").hide(),window.MtaH5&&a.mtaid&&MtaH5.clickStat("wxshare."+a.mtaid+"."+b.errMsg.replace(":ok",""))},wx.onMenuShareTimeline($.extend([],d,b.timeline)),wx.onMenuShareAppMessage($.extend([],d,b.appMessage)),wx.onMenuShareQQ($.extend([],d,b.QQ)),wx.onMenuShareQZone($.extend([],d,b.QZone)),e=["menuItem:share:appMessage","menuItem:share:timeline","menuItem:share:qq","menuItem:share:QZone"],b.channels&&(e=b.channels.split(",").map(function(a){return e[a-1]})),ddb.wx.showShareMenu(c,e),setTimeout(function(){ddb.wx.showShareMenu(c,e)},1e3)}),wx.error(function(a){console.log(a)})}if(ddb.isWeixin&&window.wx){var c=a.isShare||B.url.getParam("share");1==c&&$("nav button").addClass("showNone").filter(".publicNum").removeClass("showNone"),a.JSSDK_CFG=a.JSSDK_CFG||ddb.JSSDK_CFG,ddb.wx.hideShareMenu(a.JSSDK_CFG),a.url?ddb.wx.getInfo(a.url,d):a.JSSDK_CFG?d(a.JSSDK_CFG):ddb.wx.getInfo(d)}},ddb.wx.hideShareMenu=function(a,b){function c(a){ddb.wx.setConfig(a),wx.ready(function(){b=b||["menuItem:share:appMessage","menuItem:share:timeline","menuItem:share:qq","menuItem:share:QZone"],wx.hideMenuItems({menuList:b})})}ddb.isWeixin&&window.wx&&(a=a||ddb.JSSDK_CFG,a?c(a):ddb.wx.getInfo(c))},ddb.wx.showShareMenu=function(a,b){function c(a){ddb.wx.setConfig(a),wx.ready(function(){b=b||["menuItem:share:appMessage","menuItem:share:timeline","menuItem:share:qq","menuItem:share:QZone"],wx.showMenuItems({menuList:b})})}ddb.isWeixin&&window.wx&&(a=a||ddb.JSSDK_CFG,a?c(a):ddb.wx.getInfo(c))},ddb.wx.getFollowStatus=function(a){function b(b){ddb.get("/wechat_api/isSubscribe",{urlType:"app",dataType:"text",openid:b.open_id,notCheckLogin:!0},function(b){var c="0"!==b;a(c)})}ddb.isWeixin&&(ddb.JSSDK_CFG?b(ddb.JSSDK_CFG):ddb.wx.getInfo(b))},ddb.wx.jumptoCode=function(a){var b,c;return ddb.isWeixin?(a=a||{},b="https://open.weixin.qq.com/connect/oauth2/authorize",c=B.url.setObj(b,{appid:a.appid||ddb.appid,redirect_uri:a.returl||location.href,scope:a.base?"snsapi_base":"snsapi_userinfo",response_type:"code"})+"#wechat_redirect",location.replace(c),void 0):(alert("请在微信客户端打开链接！"),void 0)},ddb.wx.gotoPublic=function(){return location.href="http://mp.weixin.qq.com/s?__biz=MzAxNDMzNjc2MQ==&mid=209057391&idx=1&sn=c3686736a269a755c2b3bbb69dcddf91&scene=1&key=1936e2bc22c2ceb5f0422d19def4dd7e2ead657bd6a2be972adadb5206e9105a41e4bcaeaabb99c6bb8a0a9c37a78489&ascene=1&uin=MTAzNDg1ODg4MQ%3D%3D&devicetype=Windows+8&version=61000721&pass_ticket=Koa33YxOOGuMY5d5XE%2BTNfpOefmOQ0oQUIO%2BVO0f9PbEwF0GPMj%2BeH1mkKvSd45M",!1},ddb.jumpCommonUrl=function(a){var b="http://"+ddb.sld+"jump.buskeji.com/common/load?page="+a;b=B.url.setObj(b,{version:ddb.version,device_type:3,city_code:ddb.store("ddbCity")?ddb.store("ddbCity").split("/")[1]:"0755"}),window.location=b},ddb.scrollRefresh=function(a,b){var c,d;"function"==typeof a&&(b=a,a=document.body),c=a.scrollHeight-document.documentElement.clientHeight,d=c-a.scrollTop,100>d&&b()},ddb.setShare=function(a,b){(ddb.isWeixin||ddb.isApp)&&(ddb.wx.shared=!0,a.notCheckLogin=!0,a.noLoading=!0,ddb.get("share/get_share_url",a,function(c){var d,e;0===+c.ret&&(d=c.data.share_channel_list.map(function(a){return a.share_channel_id}),e={title:c.data.share_title,desc:c.data.share_detail,link:ddb.fitEnv(c.data.share_url),channels:d.join(",")},c.data.share_channel_list.forEach(function(a){var b={};switch(a.share_title&&(b.title=a.share_title),a.share_detail&&(b.desc=a.share_detail),a.share_url&&(b.link=a.share_url),a.share_icon&&(b.imgUrl=a.share_icon),+a.share_channel_id){case 1:e.appMessage=b;break;case 2:e.timeline=b;break;case 3:e.QQ=b;break;case 4:e.QZone=b}}),ddb.wx.share({mtaid:a.mtaid,JSSDK_Share:e}),"function"==typeof b&&b($.extend({imgUrl:ddb.wx.shareConfig.imgUrl,appCfg:JSON.stringify(c.data)},e)))}))},ddb.ui={},ddb.tl={},ddb.tl.fixPrice=function(a){var b,c,d,e,f;if("undefined"==typeof a||!a)return a;if(b=a.toString(),0==a)return"0";if(-1==b.indexOf("."))return a;for(c=b.split("."),d=c[1],0==c[0]&&(c[0]=0),d.length>=2&&(d=d.substr(0,2)),e=0,f=d.length;f>e;e++)d.length>0&&0==d.charAt(d.length-1)&&(d=d.slice(0,-1));return d.length>0?c[0]+"."+d:c[0]},ddb.tl.loadContent=function(a,b,c){return $.ajax({url:a,dataType:"html",timeout:b.timeout||15e3,cache:!0,data:b,success:function(a){c&&c(a)},error:function(){alert("网络异常!")}})},ddb.tl.loadCss=function(a){$("<link>").attr({rel:"stylesheet",type:"text/css",href:a}).appendTo("head")},ddb.tl.clone=function(a){return JSON.parse(JSON.stringify(a))},ddb.Popup=function(){var a,b,c,e,j,k,l,m,n,o,p,q,r,f={center:{top:"50%",left:".5rem",right:".5rem","border-radius":".2rem"}},g={msg:'<div class="popup-content popup-msg {_class}">{content}</div>',alert:'<div class="popup-title {_class}">{title}</div><div class="popup-content {_class}">{content}</div><div id="ddb_popup_btn_container"><a data-target="closePopup" data-icon="checkmark">{ok}</a></div>',tips:'<div class="popup-tips-title">{title}</div><div class="popup-tips-content">{content}</div>',confirm:'<div class="popup-title {_class}">{title}</div><div class="popup-content {_class}">{content}</div><div id="ddb_popup_btn_container"><a class="cancel" data-icon="close">{cancel}</a><a data-icon="checkmark">{ok}</a></div>',intro:'<div class="popup-title {_class}">{title}</div><div class="popup-content {_class}">{content}</div><div id="ddb_popup_btn_container"><a class="ddb_popup_intro_ok" data-icon="checkmark">{ok}</a></div>',loading:'<i class="icon spinner"></i>',center:'<div class="popup_tips {_class}">{_img}<div class="popup_tips_title">{title}</div><div class="popup_tips_text1">{text1}</div><div class="popup_tips_text2">{text2}</div></div>'},h=function(){$("body").append('<div id="ddb_popup"></div><div id="ddb_popup_mask"></div>'),c=$("#ddb_popup_mask"),b=$("#ddb_popup"),l()},i={};return i.show=function(){var b=g.loading;j({html:b,pos:"loading",opacity:.1,animation:!0,clickMask2Close:!1})},i.hide=function(){k()},j=function(a,d){var h,j,k,g={height:void 0,width:void 0,opacity:.6,html:"",pos:"center",clickMask2Close:!0,showCloseBtn:!0,onShow:void 0};if($.extend(g,a),e=g.clickMask2Close,c.css("opacity",g.opacity),b.attr({style:"","class":""}),g.width&&b.width(g.width),g.height&&b.height(g.height),h=$.type(g.pos),"object"==h)b.css(g.pos);else{if("string"!=h)return console.error("错误的参数！"),void 0;f[g.pos]?(b.css(f[g.pos]),g.pos.indexOf("top")>-1?"top":g.pos.indexOf("bottom")>-1?"bottom":"defaultAnim"):b.addClass(g.pos)}c.show(),g.html?j=g.html:g.url?j=J.Page.loadContent(g.url):g.tplId&&(j=template(g.tplId,g.tplData)),g.showCloseBtn&&(j+='<div id="tag_close_popup" data-target="closePopup" class="icon cancel-circle"></div>'),b.html(j).show(),g.onShow&&g.onShow.call(b),"center"==g.pos&&(k=b.height(),b.css("margin-top","-"+k/2+"px")),d&&d()},k=function(){c.hide(),b.hide().empty()},l=function(){c.on("click",function(){e&&k()}),b.on("click",'[data-target="closePopup"]',function(){k()})},m=function(a,b,c){var d=g.alert.replace("{title}",a).replace("{content}",b).replace("{ok}",c||"确定");j({html:d,pos:"center",opacity:.6,showCloseBtn:!1})},n=function(a,b){var d=g.tips.replace("{title}",a).replace("{content}",b);j({html:d,pos:"center",opacity:.4,showCloseBtn:!1})},o=function(a,b,c,d,e,f,h,i){if($.isPlainObject(a)){var l=$.extend({className:"",title:"",content:"",okText:"",cancelText:"",clickMask2Close:!0,okCall:function(){},cancelCall:function(){}},a);i=l.clickMask2Close,a=l.className,b=l.title,c=l.content,d=l.cancelText,e=l.okText,f=l.okCall,h=l.cancelCall}else d=d||"取消",e=e||"确定";j({html:g.confirm.replace("{title}",b).replace("{content}",c).replace("{cancel}",d).replace("{ok}",e).replace(/{_class}/g,a),pos:"center",opacity:.4,showCloseBtn:!1,clickMask2Close:i}),$('#ddb_popup_btn_container [data-icon="checkmark"]').on("click",function(){f.call(this),k()}),$('#ddb_popup_btn_container [data-icon="close"]').on("click",function(){h.call(this),k()})},p=function(a,b,c,d,e,f){if($.isPlainObject(a)){var h=$.extend({className:"",title:"",content:"",okText:"",clickMask2Close:!0,okCall:function(){}},a);f=h.clickMask2Close,a=h.className,b=h.title,c=h.content,d=h.okText,e=h.okCall}else d=d||"确定";j({html:g.intro.replace("{title}",b).replace("{content}",c).replace("{ok}",d).replace(/{_class}/g,a),pos:"center",opacity:.4,showCloseBtn:!1,clickMask2Close:f}),$('#ddb_popup_btn_container [data-icon="checkmark"]').on("click",function(){e.call(this),k()})},q=function(b){a&&clearTimeout(a);var c=g.msg.replace("{content}",b);j({html:c,pos:"center",opacity:.6,showCloseBtn:!1})},r=function(b,c,d){"string"!=typeof b&&(d=c,c=b,b='<img src="/webapp/image/icon_success.png">'),b=b||"",c=$.extend({className:"",title:"",text1:"",text2:"",delay:3e3},c||{}),d=d||g.center.replace("{_img}",b).replace("{title}",c.title).replace("{text1}",c.text1).replace("{text2}",c.text2).replace("{_class}",c.className),j({html:d,pos:"center",opacity:0,showCloseBtn:!1},function(){$("#ddb_popup").css("background","rgba(0, 0, 0, 0)").addClass(c.className)}),a&&clearTimeout(a),a=setTimeout(function(){k(),c.callback&&c.callback()},c.delay)},h(),{loading:i,show:j,close:k,alert:m,tips:n,msg:q,confirm:o,intro:p,center:r}}(),ddb.Toast=function(a){var c,d,b="toast",e={toast:'<a href="#">{value}</a>',success:'<a href="#"><i class="icon checkmark-circle"></i>{value}</a>',error:'<a href="#"><i class="icon cancel-circle"></i>{value}</a></div>',info:'<a href="#"><i class="icon info-2"></i>{value}</a>'},f=function(){a("body").append('<div id="ddb_toast"></div>'),c=a("#ddb_toast"),i()},g=function(){c.hide(),c.empty()},h=function(a,f,h){d&&clearTimeout(d),f=f||"toast",h=h||3e3;var i=f.split(/\s/);b=i[0],c.attr("class",f).html(e[b].replace("{value}",a)).show(),0!==h&&(d=setTimeout(g,h))},i=function(){c.on("click",'[data-target="close"]',function(){g()})};return f(),{show:h,hide:g}}($),ddb.loading=function(){var a=document.getElementById("ddb-loading")||$('<div id="ddb-loading"><i></i></div>').appendTo("body")[0];return{show:function(b){a&&(a.style.display="block","<i></i>"!==$(a).html&&$(a).html("<i></i>"),b&&$(a).html("<span><p><i></i>"+b+"</p></span>"))},hide:function(){a&&(a.style.display="none")}}}(),ddb.getChatTokenCallback=function(a){var b=ddb.cookie("wx_user_id"),c="chat_token_"+b,d=ddb.session(c);b&&(d?a(d):ddb.get("chat/get_rongcloud_token",function(b){return 0!==+b.ret?(alert(b.msg),void 0):b.data.token?(console.log("get token: ",d),ddb.session(c,b.data.token),a(b.data.token),void 0):(alert("token 值为空"),void 0)
}))},window.oAlert=window._alert=window.alert,window.alert=ddb.Toast.show,"release"!==ddb.dev_status||B.url.getParam("debug")||(window.onerror=console.log=console.error=console.debug=console.warn=console.info=ddb.noop),ddb.getCityByCode=function(a,b){var c="";return(b=b||ddb.CITYS)?(b.some(function(b){return b.code==a?(c=b.city,!0):void 0}),c):c},ddb.initApp=function a(){if(ddb.app=window.DDBApp||window.android,ddb.isApp&&(document.documentElement.classList.add("ddbapp"),ddb.isIosApp&&document.documentElement.classList.add("iosapp"),ddb.common=ddb.session("appCommon"),!ddb.common||!B.user.isLogin())){var b=ddb.app?ddb.app.getCommonParams():ddb.cookie("ddb_app_general")||location.search.substring(1);ddb.isAndroidApp&&(b=b||ddb.cookie("ddb_app_general")),"release"!==ddb.dev_status&&(b=ddb.cookie("ddb_app_general")||ddb.store("ddb_app_general")),ddb.common=B.url.serializeArray(decodeURIComponent(b)),ddb.cookie("wx_mobile",ddb.common.mobile||"",{path:"/"}),ddb.cookie("wx_user_id",ddb.common.user_id||"",{path:"/"}),ddb.cookie("wx_device_id",ddb.common.device_id||"",{path:"/"}),ddb.cookie("wx_ddb_token",ddb.common.ddb_token||"",{path:"/"}),ddb.session("ddb_src_id",ddb.common.ddb_src_id||""),ddb.common.city_code=ddb.common.city_code||"0755",ddb.store("ddbCity",ddb.getCityByCode(ddb.common.city_code)+"/"+ddb.common.city_code),ddb.common.mobile&&ddb.common.user_id?ddb.session("appCommon",ddb.common):ddb.session("appCommon",null)}return a}(),ddb.appready=function(){function f(a){for(b=1;a=c.shift();)a()}var a,b,d,c,e;if(ddb.isApp)return a=window.document,b=!!window.DDBApp,c=[],e=setInterval(function(){window.DDBApp&&(clearInterval(e),f())},50),a.addEventListener("DDBAppReady",d=function(){a.removeEventListener("DDBAppReady",d),f()}),function(a){ddb.isApp&&(b?a():c.push(a))}}(),ddb.appCall=function(){var a,b;ddb.isApp&&(a=arguments[0],b=[].slice.call(arguments,1),ddb.appready(function(){ddb.app=window.DDBApp||window.android;try{b.length?ddb.app[a].apply(ddb.app,b):ddb.app[a]()}catch(c){alert(c)}}))},ddb.isApp&&ddb.appready(function(){ddb.app=window.DDBApp||window.android,ddb.session("appCommon")||ddb.initApp();try{ddb.app&&ddb.app.getEnv&&(ddb.dev_status=ddb.app.getEnv().replace(/\s+/g," ")||ddb.dev_status,ddb.sld="release"===ddb.dev_status?"":ddb.dev_status+".",ddb.api="http://"+ddb.sld+"api.buskeji.com/")}catch(a){}}),ddb.wx.hideShareMenu(),$(window).on("load",function(){ddb.inPath("public|volunteer|chat")||ddb.wx.shared||ddb.wx.share({JSSDK_Share:{title:"欢乐斗地主嗒嗒巴士赛",desc:"斗地主，赢福利，一大波福利来袭",link:"http://"+ddb.host+"/h5/active/dadaddz/index.html",imgUrl:"http://"+ddb.host+"/h5/active/dadaddz/image/share.png"}})}),"release"===ddb.dev_status&&(function(){var a=document.createElement("script");a.src="http://pingjs.qq.com/h5/stats.js",a.setAttribute("name","MTAH5"),a.setAttribute("sid","500005480"),a.setAttribute("cid","500005481"),document.head.appendChild(a)}(),$(document.body).on("click","[data-mtaid]",function(){if(!window.MtaH5)return $(document).off("click","[data-mtaid]"),void 0;var a=$.trim($(this).data("mtaid").toLowerCase());-1!==a.indexOf(" ")?a.split(" ").forEach(function(a){MtaH5.clickStat(a),console.log("上报统计："+a)}):a&&(MtaH5.clickStat(a),console.log("上报统计："+a))})),"2128"===ddb.session("ddb_src_id")&&(document.documentElement.classList.add("sogou-app"),function(){var a=document.createElement("script");a.src="http://fuwu.wap.sogou.com/static/partner.js",a.setAttribute("sogouid","085"),document.head.appendChild(a)}()),document.addEventListener("DOMContentLoaded",function(){var b,c;document.documentElement,b=document.getElementById("loadcover"),b&&(ddb.hideLoadcover=function(){setTimeout(function(){b.className="hide-loadcover"},300),setTimeout(function(){b.parentNode.removeChild(b)},600)},"none"!==b.getAttribute("data-hide")&&ddb.hideLoadcover()),c=$("button.newBack, .g-navbar .back"),c.on("click",function(){window.history.go(-1)}),$("html.doc").find("article dd:has(i)").addClass("has-index"),("tplMsg"===B.url.getParam("from")||ddb.isApp)&&c.not(".forced-show").hide()});